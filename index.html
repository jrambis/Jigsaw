<!DOCTYPE html>
<!--
    Multiplayer Jigsaw Puzzle - v2.1.0
    Multiuser Mode: Shared puzzles, real-time sync
    Deployed via GitHub Actions
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1e1e23" id="themeColorMeta">
    <meta name="version" content="2.1.0">
    <meta name="description" content="Solve jigsaw puzzles together in real-time with friends and family">

    <!-- Open Graph / Facebook / iMessage -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rambis.net/">
    <meta property="og:title" content="Multiplayer Jigsaw Puzzle">
    <meta property="og:description" content="Solve jigsaw puzzles together in real-time with friends and family">
    <meta property="og:image" content="https://rambis.net/images/RichLink/preview.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Multiplayer Jigsaw Puzzle">
    <meta name="twitter:description" content="Solve jigsaw puzzles together in real-time with friends and family">
    <meta name="twitter:image" content="https://rambis.net/images/RichLink/preview.png">

    <title>Multiplayer Jigsaw Puzzle</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Slim Header -->
        <header id="header">
            <button id="menuBtn" class="header-btn" title="Menu">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M2 6a1 1 0 0 1 1-1h18a1 1 0 1 1 0 2H3a1 1 0 0 1-1-1Zm0 6.032a1 1 0 0 1 1-1h18a1 1 0 1 1 0 2H3a1 1 0 0 1-1-1Zm1 5.032a1 1 0 1 0 0 2h18a1 1 0 0 0 0-2H3Z"/></svg>
            </button>
            <span id="puzzleName">Multiplayer Puzzle</span>
            <div id="headerRight">
                <span id="progressText">0%</span>
                <button id="themeBtn" class="header-btn" title="Toggle Dark Mode">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" fill-rule="evenodd" d="M277.333 405.333v85.333h-42.667v-85.333zm99.346-58.824l60.34 60.34l-30.17 30.17l-60.34-60.34zm-241.359 0l30.17 30.17l-60.34 60.34l-30.17-30.17zM256 139.353c64.422 0 116.647 52.224 116.647 116.647c0 64.422-52.225 116.647-116.647 116.647A116.427 116.427 0 0 1 139.352 256c0-64.423 52.225-116.647 116.648-116.647m0 42.666c-40.859 0-73.981 33.123-73.981 74.062a73.76 73.76 0 0 0 21.603 52.296c13.867 13.867 32.685 21.64 52.378 21.603zm234.666 52.647v42.667h-85.333v-42.667zm-384 0v42.667H21.333v-42.667zM105.15 74.98l60.34 60.34l-30.17 30.17l-60.34-60.34zm301.7 0l30.169 30.17l-60.34 60.34l-30.17-30.17zM277.332 21.333v85.333h-42.667V21.333z"/></svg>
                </button>
                <button id="bugReportBtn" class="header-btn" title="Report Bug">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21q-1.625 0-3.013-.8T6.8 18H4.975q-.425 0-.7-.288T4 17.013q0-.425.288-.713t.712-.287H6.1q-.05-.25-.075-.5T6 15H4.975q-.425 0-.7-.287T4 14.013q0-.425.288-.713t.712-.287H6v-1.5H4.975q-.425 0-.7-.288T4 11.013q0-.425.288-.713t.712-.287H6.1q.1-.525.275-1.013t.45-.962l-.975-.975q-.3-.3-.3-.712t.3-.713q.3-.3.713-.3t.712.3l.85.85Q9 5.55 10.05 5.075T12.025 4.5q.975 0 2 .463T15.15 5.85l.775-.775q.3-.3.713-.3t.712.3q.3.3.3.713t-.3.712l-.9.9q.275.45.463.925t.287 1h1.825q.425 0 .7.287t.275.7q0 .426-.288.713t-.712.288H17v1.5h1.025q.425 0 .7.287t.275.7q0 .426-.288.713t-.712.288H17q0 .275-.025.525t-.075.5h1.125q.425 0 .7.287t.275.7q0 .426-.288.713t-.712.288H16.2q-.8 1.4-2.188 2.2T11 21h1Zm0-2q1.65 0 2.825-1.175T16 15v-3q0-1.65-1.175-2.825T12 8t-2.825 1.175T8 12v3q0 1.65 1.175 2.825T12 19Zm-1-3h2q.425 0 .713-.288T14 15.013q0-.425-.288-.713T13 14.013h-2q-.425 0-.713.287T10 15.013q0 .425.288.712t.712.288Zm0-3h2q.425 0 .713-.288T14 12.013q0-.425-.288-.713T13 11.013h-2q-.425 0-.713.287T10 12.013q0 .425.288.712t.712.288Zm1 1Z"/></svg>
                </button>
                <button id="settingsBtn" class="header-btn" title="Settings">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M10.546 2.438a1.957 1.957 0 0 0 2.908 0L14.4 1.4a1.959 1.959 0 0 1 3.41 1.413l-.071 1.4a1.96 1.96 0 0 0 2.051 2.054l1.4-.071a1.96 1.96 0 0 1 1.41 3.41l-1.042.94a1.96 1.96 0 0 0 0 2.909l1.042.94a1.96 1.96 0 0 1-1.413 3.41l-1.4-.071a1.96 1.96 0 0 0-2.056 2.056l.071 1.4A1.96 1.96 0 0 1 14.4 22.6l-.941-1.041a1.96 1.96 0 0 0-2.908 0L9.606 22.6A1.96 1.96 0 0 1 6.2 21.192l.072-1.4a1.96 1.96 0 0 0-2.056-2.056l-1.4.071A1.957 1.957 0 0 1 1.4 14.4l1.041-.94a1.96 1.96 0 0 0 0-2.909L1.4 9.606A1.958 1.958 0 0 1 2.809 6.2l1.4.071a1.96 1.96 0 0 0 2.058-2.06L6.2 2.81A1.959 1.959 0 0 1 9.606 1.4z"/><path d="M7.5 12.001a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0"/></g></svg>
                </button>
            </div>
        </header>

        <div id="canvasContainer">
            <canvas id="puzzleCanvas"></canvas>
        </div>
    </div>

    <!-- Slide-out Drawer -->
    <div id="drawer" class="drawer">
        <div class="drawer-content">
            <h3>Puzzle</h3>
            <div class="drawer-group">
                <label>Image:</label>
                <div class="drawer-row">
                    <select id="imageSelect">
                        <option value="images/DisneyHoliday.jpg">Disney Holiday</option>
                    </select>
                    <button id="uploadBtn" class="drawer-upload-btn" title="Upload a new image">+</button>
                </div>
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
            </div>
            <div class="drawer-group" id="pieceCountGroup">
                <label>Pieces:</label>
                <select id="pieceCount">
                    <option value="4">4 pieces (debug)</option>
                    <option value="25">25 pieces</option>
                    <option value="50">50 pieces</option>
                    <option value="100">100 pieces</option>
                    <option value="200" selected>200 pieces</option>
                    <option value="500">500 pieces</option>
                    <option value="1000">1000 pieces</option>
                    <option value="1500">1500 pieces</option>
                </select>
            </div>
            <button id="startBtn">Start New Puzzle</button>
            <button id="resetViewBtn">Reset View</button>

            <h3>Help</h3>
            <p><strong>Touch:</strong> Tap=Pan, Hold+Drag=Move, Pinch=Zoom</p>
            <p><strong>Mouse:</strong> Drag=Pan, Alt+Drag=Move, Shift+Drag=Select</p>
        </div>
    </div>
    <div id="drawerOverlay" class="drawer-overlay"></div>

    <!-- Floating Tool Palette (draggable) -->
    <div id="toolPalette" class="tool-palette">
        <div id="toolPaletteHandle" class="tool-palette-handle">‚ãÆ‚ãÆ</div>
        <button id="lassoBtn" class="tool-btn" title="Lasso Select">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M11.975 21.95q-.875 0-1.737-.137t-1.663-.463q-.3-.1-.487-.35t-.188-.6q0-.425.288-.713T8.9 19.4l.35.05q.675.225 1.338.363t1.387.137q.425 0 .713.288t.287.712q0 .425-.287.713t-.713.287Zm4-1q-.425 0-.712-.287t-.288-.713v-4q0-.425.288-.712t.712-.288h4q.425 0 .713.288t.287.712q0 .425-.288.713t-.712.287h-1.6l2.1 2.1q.275.275.288.688t-.288.712q-.275.275-.7.275t-.7-.275l-2.1-2.1v1.6q0 .425-.288.713t-.712.287ZM5.625 19.3q-.2 0-.388-.087T4.925 19Q4.1 18.2 3.5 17.25t-.975-2.025q-.05-.1-.05-.35q0-.425.288-.713t.712-.287q.35 0 .6.2t.35.5q.3.875.775 1.625t1.125 1.4q.125.125.213.312t.087.388q0 .425-.288.713t-.712.287Zm15.35-6.35q-.425 0-.713-.287t-.287-.713q0-.725-.138-1.387t-.362-1.338q-.05-.1-.05-.35q0-.425.288-.713t.712-.287q.35 0 .6.188t.35.487q.325.8.463 1.663t.137 1.737q0 .425-.288.713t-.712.287ZM3.025 12q-.425 0-.712-.287T2.025 11v-.175q.15-1.125.525-2.2T3.525 6.6q.125-.2.35-.338t.5-.137q.425 0 .713.287t.287.713q0 .15-.05.3T5.2 7.7q-.5.775-.775 1.638t-.4 1.762q-.05.375-.325.638T3.025 12Zm15.3-5.4q-.2 0-.387-.087t-.313-.213q-.65-.65-1.4-1.125T14.6 4.4q-.3-.1-.5-.35t-.2-.6q0-.425.288-.712t.712-.288l.35.05q1.075.375 2.025.975t1.75 1.425q.125.125.213.313t.087.387q0 .425-.287.713t-.713.287ZM7.15 5.35q-.425 0-.712-.287T6.15 4.35q0-.275.138-.5t.337-.35q.95-.6 2.025-.975T10.85 2h.175q.425 0 .713.288t.287.712q0 .4-.263.675T11.126 4q-.9.125-1.763.4t-1.637.775Q7.6 5.25 7.45 5.3t-.3.05Z"/></svg>
        </button>
        <button id="gridBtn" class="tool-btn" title="Grid Arrange">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1025 1024"><path fill="currentColor" d="M960.356 1024h-128q-26 0-45-19t-19-45V832q0-26 19-45t45-19h128q26 0 45 19t19 45v128q0 27-18.5 45.5t-45.5 18.5zm0-384h-128q-26 0-45-18.5t-19-45.5V448q0-27 19-45.5t45-18.5h128q26 0 45 18.5t19 45.5v128q0 27-18.5 45.5t-45.5 18.5zm0-384h-128q-26 0-45-19t-19-45V64q0-27 19-45.5t45-18.5h128q26 0 45 18.5t19 45.5v128q0 26-18.5 45t-45.5 19zm-384 768h-128q-27 0-45.5-19t-18.5-45V832q0-26 19-45t45-19h128q27 0 45.5 19t18.5 45v128q0 27-18.5 45.5t-45.5 18.5zm0-384h-128q-27 0-45.5-18.5t-18.5-45.5V448q0-27 19-45.5t45-18.5h128q27 0 45.5 18.5t18.5 45.5v128q0 27-18.5 45.5t-45.5 18.5zm0-384h-128q-27 0-45.5-19t-18.5-45V64q0-27 19-45.5t45-18.5h128q27 0 45.5 18.5t18.5 45.5v128q0 26-18.5 45t-45.5 19zm-384 768h-128q-26 0-45-19t-19-45V832q0-26 19-45t45-19h128q26 0 45 19t19 45v128q0 27-18.5 45.5t-45.5 18.5zm0-384h-128q-26 0-45-18.5t-19-45.5V448q0-27 19-45.5t45-18.5h128q26 0 45 18.5t19 45.5v128q0 27-18.5 45.5t-45.5 18.5zm0-384h-128q-26 0-45-19t-19-45V64q0-27 19-45.5t45-18.5h128q26 0 45 18.5t19 45.5v128q0 26-18.5 45t-45.5 19z"/></svg>
        </button>
        <button id="referenceBtn" class="tool-btn" title="Reference Image">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M19 4H5a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3ZM5 18a1 1 0 0 1-1-1v-2.42l3.3-3.29a1 1 0 0 1 1.4 0L15.41 18Zm15-1a1 1 0 0 1-1 1h-.77l-3.81-3.83l.88-.88a1 1 0 0 1 1.4 0l3.3 3.29Zm0-3.24l-1.88-1.87a3.06 3.06 0 0 0-4.24 0l-.88.88l-2.88-2.88a3.06 3.06 0 0 0-4.24 0L4 11.76V7a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1Z"/></svg>
        </button>
        <div class="tool-divider"></div>
        <button id="undoBtn" class="tool-btn" title="Undo" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 64c-56.8 0-107.9 24.7-143.1 64H160c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V32C0 14.3 14.3 0 32 0s32 14.3 32 32v54.7C110.9 33.6 179.5 0 256 0c141.4 0 256 114.6 256 256S397.4 512 256 512c-87 0-163.9-43.4-210.1-109.7c-10.1-14.5-6.6-34.4 7.9-44.6s34.4-6.6 44.6 7.9c34.8 49.8 92.4 82.3 157.6 82.3c106 0 192-86 192-192S362 64 256 64"/></svg>
        </button>
        <button id="redoBtn" class="tool-btn" title="Redo" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M436.7 74.7L448 85.4V32c0-17.7 14.3-32 32-32s32 14.3 32 32v128c0 17.7-14.3 32-32 32H352c-17.7 0-32-14.3-32-32s14.3-32 32-32h47.9l-7.6-7.2l-.6-.6c-75-75-196.5-75-271.5 0s-75 196.5 0 271.5s196.5 75 271.5 0q12.3-12.3 21.9-26.1c10.1-14.5 30.1-18 44.6-7.9s18 30.1 7.9 44.6c-8.5 12.2-18.2 23.8-29.1 34.7c-100 100-262.1 100-362 0S-25 175 75 75c99.9-99.9 261.7-100 361.7-.3"/></svg>
        </button>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button id="closeSettingsBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="-2 -2 24 24"><path fill="currentColor" d="m11.414 10l2.829 2.828a1 1 0 0 1-1.415 1.415L10 11.414l-2.828 2.829a1 1 0 1 1-1.415-1.415L8.586 10L5.757 7.172a1 1 0 0 1 1.415-1.415L10 8.586l2.828-2.829a1 1 0 0 1 1.415 1.415L11.414 10zM10 20C4.477 20 0 15.523 0 10S4.477 0 10 0s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- User Settings -->
                <section class="settings-section">
                    <h3>Your Profile</h3>
                    <div class="form-group">
                        <label for="userNameInput">Display Name</label>
                        <input type="text" id="userNameInput" maxlength="20" placeholder="Player" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>Colors</label>
                        <div class="color-pickers-row">
                            <div class="color-picker-item">
                                <span>You</span>
                                <input type="color" id="userColorInput" value="#667eea">
                            </div>
                            <div class="color-picker-item">
                                <span>Canvas (Light)</span>
                                <input type="color" id="canvasColorLight" value="#f0f0f0">
                            </div>
                            <div class="color-picker-item">
                                <span>Canvas (Dark)</span>
                                <input type="color" id="canvasColorDark" value="#2a2a2a">
                            </div>
                        </div>
                    </div>
                    <p class="settings-note auto-save-note">Settings auto-save</p>
                </section>

                <!-- Puzzle Management -->
                <section class="settings-section">
                    <h3>Puzzle</h3>
                    <div class="button-row">
                        <button id="showBackupsBtn" class="btn-secondary">View Backups</button>
                        <button id="resetPuzzleBtn" class="btn-danger">Reset Puzzle</button>
                    </div>
                    <p class="settings-note">Backups are created automatically every 3 minutes.</p>
                </section>

                <!-- Uploaded Images -->
                <section class="settings-section">
                    <h3>Uploaded Images</h3>
                    <div id="uploadedImagesList">
                        <p class="settings-note">Loading...</p>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Backup Browser Modal -->
    <div id="backupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Puzzle Backups</h2>
                <button id="closeBackupModalBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="-2 -2 24 24"><path fill="currentColor" d="m11.414 10l2.829 2.828a1 1 0 0 1-1.415 1.415L10 11.414l-2.828 2.829a1 1 0 1 1-1.415-1.415L8.586 10L5.757 7.172a1 1 0 0 1 1.415-1.415L10 8.586l2.828-2.829a1 1 0 0 1 1.415 1.415L11.414 10zM10 20C4.477 20 0 15.523 0 10S4.477 0 10 0s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="backupList">
                    <p>Loading backups...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bug Report Modal -->
    <div id="bugReportOverlay" class="bug-report-overlay">
        <div class="bug-report-modal">
            <div class="modal-header">
                <h2>üêõ Report a Bug</h2>
                <button id="closeBugReportBtn" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="-2 -2 24 24"><path fill="currentColor" d="m11.414 10l2.829 2.828a1 1 0 0 1-1.415 1.415L10 11.414l-2.828 2.829a1 1 0 1 1-1.415-1.415L8.586 10L5.757 7.172a1 1 0 0 1 1.415-1.415L10 8.586l2.828-2.829a1 1 0 0 1 1.415 1.415L11.414 10zM10 20C4.477 20 0 15.523 0 10S4.477 0 10 0s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="bugDescription">What happened?</label>
                    <textarea id="bugDescription" rows="5" placeholder="What happened? What did you expect?"></textarea>
                </div>
                <div class="button-row">
                    <button id="cancelBugReportBtn" class="btn-secondary">Cancel</button>
                    <button id="submitBugReportBtn" class="btn-primary">Submit Report</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="js/PuzzleAPI.js"></script>
    <script src="js/PuzzleCutter.js"></script>
    <script src="js/PuzzleEngine.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
